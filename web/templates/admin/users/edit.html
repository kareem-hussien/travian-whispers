{% extends "admin/base.html" %}

{% block content %}
<div class="container-fluid py-4">
  <div class="row">
    <div class="col-12">
      <div class="card mb-4">
        <div class="card-header pb-0 d-flex justify-content-between align-items-center">
          <h6>Edit User: {{ user.username }}</h6>
          <a href="{{ url_for('admin.users') }}" class="btn btn-sm btn-primary">Back to Users</a>
        </div>
        <div class="card-body px-4 pt-0 pb-4">
          <form method="POST" action="{{ url_for('admin.users.user_edit', user_id=user.id) }}">
            <div class="row mt-3">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="username" class="form-control-label">Username</label>
                  <input class="form-control" type="text" id="username" value="{{ user.username }}" disabled>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="email" class="form-control-label">Email</label>
                  <input class="form-control" type="email" id="email" name="email" value="{{ user.email }}" required>
                </div>
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="role" class="form-control-label">Role</label>
                  <select class="form-control" id="role" name="role">
                    <option value="user" {% if user.role == 'user' %}selected{% endif %}>User</option>
                    <option value="admin" {% if user.role == 'admin' %}selected{% endif %}>Admin</option>
                  </select>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="status" class="form-control-label">Status</label>
                  <select class="form-control" id="status" name="status">
                    <option value="active" {% if user.status == 'active' %}selected{% endif %}>Active</option>
                    <option value="inactive" {% if user.status == 'inactive' %}selected{% endif %}>Inactive</option>
                  </select>
                </div>
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="new_password" class="form-control-label">New Password</label>
                  <input class="form-control" type="password" id="new_password" name="new_password" placeholder="Leave blank to keep current password">
                </div>
              </div>
            </div>
            
            <hr class="horizontal dark my-4">
            <h6 class="mb-3">Subscription Details</h6>
            
            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="subscription_plan" class="form-control-label">Subscription Plan</label>
                  <select class="form-control" id="subscription_plan" name="subscription_plan">
                    <option value="none" {% if not user.subscription.plan_id %}selected{% endif %}>No Subscription</option>
                    {% for plan in plans %}
                    <option value="{{ plan._id }}" {% if user.subscription.plan_id == plan._id|string %}selected{% endif %}>
                      {{ plan.name }} - ${{ plan.price.monthly }}/month
                    </option>
                    {% endfor %}
                  </select>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="billing_period" class="form-control-label">Billing Period</label>
                  <select class="form-control" id="billing_period" name="billing_period">
                    <option value="monthly">Monthly</option>
                    <option value="yearly">Yearly</option>
                  </select>
                </div>
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <label class="form-control-label">Current Status</label>
                  <div class="input-group">
                    <span class="input-group-text">
                      <i class="ni ni-calendar-grid-58"></i>
                    </span>
                    <input class="form-control" type="text" value="{{ user.subscription.status|capitalize }}" disabled>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label class="form-control-label">Current Plan</label>
                  <div class="input-group">
                    <span class="input-group-text">
                      <i class="ni ni-tag"></i>
                    </span>
                    <input class="form-control" type="text" value="{{ user.subscription.plan.name if user.subscription.plan else 'None' }}" disabled>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <label class="form-control-label">Start Date</label>
                  <div class="input-group">
                    <span class="input-group-text">
                      <i class="ni ni-calendar-grid-58"></i>
                    </span>
                    <input class="form-control" type="text" value="{{ user.subscription.start_date|default('N/A', true) }}" disabled>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label class="form-control-label">End Date</label>
                  <div class="input-group">
                    <span class="input-group-text">
                      <i class="ni ni-calendar-grid-58"></i>
                    </span>
                    <input class="form-control" type="text" value="{{ user.subscription.end_date|default('N/A', true) }}" disabled>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="row mt-4">
              <div class="col-12 text-end">
                <a href="{{ url_for('admin.users') }}" class="btn btn-secondary">Cancel</a>
                <button type="submit" class="btn btn-primary">Update User</button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
