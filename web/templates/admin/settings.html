{% extends 'admin/components/admin-layout.html' %}

{% block title %}System Settings{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item active" aria-current="page">Settings</li>
{% endblock %}

{% block content %}
<!-- Page Header -->
{% with 
    title="System Settings",
    subtitle="Configure system-wide settings and preferences",
    show_buttons=false
%}
    {% include 'admin/components/admin-page-header.html' %}
{% endwith %}

<!-- Settings Tabs -->
<div class="row">
    <div class="col-lg-3 mb-4">
        <div class="dashboard-card">
            <div class="nav flex-column nav-pills" id="settings-tab" role="tablist" aria-orientation="vertical">
                <button class="nav-link {% if active_tab == 'general' or not active_tab %}active{% endif %}" 
                        id="general-tab" data-bs-toggle="pill" 
                        data-bs-target="#general" type="button" role="tab" 
                        aria-controls="general" aria-selected="{% if active_tab == 'general' or not active_tab %}true{% else %}false{% endif %}">
                    <i class="bi bi-gear me-2"></i> General
                </button>
                <button class="nav-link {% if active_tab == 'email' %}active{% endif %}" 
                        id="email-tab" data-bs-toggle="pill" 
                        data-bs-target="#email" type="button" role="tab" 
                        aria-controls="email" aria-selected="{% if active_tab == 'email' %}true{% else %}false{% endif %}">
                    <i class="bi bi-envelope me-2"></i> Email
                </button>
                <button class="nav-link {% if active_tab == 'payment' %}active{% endif %}" 
                        id="payment-tab" data-bs-toggle="pill" 
                        data-bs-target="#payment" type="button" role="tab" 
                        aria-controls="payment" aria-selected="{% if active_tab == 'payment' %}true{% else %}false{% endif %}">
                    <i class="bi bi-credit-card me-2"></i> Payment
                </button>
                <button class="nav-link {% if active_tab == 'security' %}active{% endif %}" 
                        id="security-tab" data-bs-toggle="pill" 
                        data-bs-target="#security" type="button" role="tab" 
                        aria-controls="security" aria-selected="{% if active_tab == 'security' %}true{% else %}false{% endif %}">
                    <i class="bi bi-shield-lock me-2"></i> Security
                </button>
                <button class="nav-link {% if active_tab == 'backup' %}active{% endif %}" 
                        id="backup-tab" data-bs-toggle="pill" 
                        data-bs-target="#backup" type="button" role="tab" 
                        aria-controls="backup" aria-selected="{% if active_tab == 'backup' %}true{% else %}false{% endif %}">
                    <i class="bi bi-cloud-arrow-up me-2"></i> Backup
                </button>
                <button class="nav-link {% if active_tab == 'system' %}active{% endif %}" 
                        id="system-tab" data-bs-toggle="pill" 
                        data-bs-target="#system" type="button" role="tab" 
                        aria-controls="system" aria-selected="{% if active_tab == 'system' %}true{% else %}false{% endif %}">
                    <i class="bi bi-info-circle me-2"></i> System Info
                </button>
            </div>
        </div>
    </div>
    
    <div class="col-lg-9">
        <div class="tab-content" id="settings-tab-content">
            <!-- General Settings Tab -->
            <div class="tab-pane fade {% if active_tab == 'general' or not active_tab %}show active{% endif %}" 
                 id="general" role="tabpanel" aria-labelledby="general-tab">
                {% include 'admin/settings-pages/general.html' %}
            </div>
            
            <!-- Email Settings Tab -->
            <div class="tab-pane fade {% if active_tab == 'email' %}show active{% endif %}" 
                 id="email" role="tabpanel" aria-labelledby="email-tab">
                {% include 'admin/settings-pages/email.html' %}
            </div>
            
            <!-- Payment Settings Tab -->
            <div class="tab-pane fade {% if active_tab == 'payment' %}show active{% endif %}" 
                 id="payment" role="tabpanel" aria-labelledby="payment-tab">
                {% include 'admin/settings-pages/payment.html' %}
            </div>
            
            <!-- Security Settings Tab -->
            <div class="tab-pane fade {% if active_tab == 'security' %}show active{% endif %}" 
                 id="security" role="tabpanel" aria-labelledby="security-tab">
                {% include 'admin/settings-pages/security.html' %}
            </div>
            
            <!-- Backup Settings Tab -->
            <div class="tab-pane fade {% if active_tab == 'backup' %}show active{% endif %}" 
                 id="backup" role="tabpanel" aria-labelledby="backup-tab">
                {% include 'admin/settings-pages/backup.html' %}
            </div>
            
            <!-- System Info Tab -->
            <div class="tab-pane fade {% if active_tab == 'system' %}show active{% endif %}" 
                 id="system" role="tabpanel" aria-labelledby="system-tab">
                {% include 'admin/settings-pages/system-info.html' %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Keep tab selection after form submission
    const urlParams = new URLSearchParams(window.location.search);
    const tabParam = urlParams.get('tab');
    
    if (tabParam) {
        const tabElement = document.getElementById(`${tabParam}-tab`);
        if (tabElement) {
            const tab = new bootstrap.Tab(tabElement);
            tab.show();
        }
    }
    
    // Handle form submission to preserve tab selection
    const forms = document.querySelectorAll('form');
    forms.forEach(form => {
        form.addEventListener('submit', function(event) {
            // Get the active tab
            const activeTab = document.querySelector('.tab-pane.active').id;
            
            // Add a hidden field to store the active tab
            let tabInput = document.createElement('input');
            tabInput.type = 'hidden';
            tabInput.name = 'active_tab';
            tabInput.value = activeTab;
            
            this.appendChild(tabInput);
        });
    });
});
</script>
{% endblock %}
